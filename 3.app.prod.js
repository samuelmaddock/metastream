(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{587:function(e,t,r){"use strict";r.r(t);var i=r(167);var o=function(e){if(!Array.isArray(e))throw new TypeError("Middleware stack must be an array!");for(const t of e)if("function"!=typeof t.match||"function"!=typeof t.resolve)throw new TypeError("Middleware must be composed of functions!");return function(t){let r=-1;return function i(o){if(o<=r)return Promise.reject(new Error("next() called multiple times"));r=o;let a=e[o];if(!a)return Promise.resolve();if(!a.match(t.req.url,t))return Promise.resolve(i(o+1));try{return Promise.resolve(a.resolve(t,function(){return i(o+1)}))}catch(e){return Promise.reject(e)}}(0)}};var a={match:({origin:e})=>e===location.origin,resolve(e,t){throw new Error("Unable to request Metastream app link")}},l=r(666),n=r(51);const s=new Set(["user-agent","referer"]),p=e=>("object"==typeof e&&(e={...e},Object.keys(e).forEach(t=>{s.has(t.toLowerCase())&&(e[`X-Metastream-${t}`]=e[t])})),e);let d=0;const m=(e,t={})=>new Promise((r,i)=>{e.startsWith("//")&&(e=`https:${e}`);try{new URL(e)}catch(e){return void i(e)}t={credentials:"omit",...t,headers:p(t.headers)};const o=d++,a=e=>{const{data:t}=e;if("object"!=typeof t)return;if(t.type!==`metastream-fetch-response${o}`)return;window.removeEventListener("message",a,!1);const{err:l,resp:n}=t.payload;l?i(l):r(n)};window.addEventListener("message",a,!1),window.postMessage({type:"metastream-fetch",payload:{requestId:o,url:e,options:t}},location.origin)}),g=async(e,t)=>{const r=await m(e,t);return[r.body,r]};var u=r(102);const c=/reddit\.com\/r\/([^\s/]+)\/?/i,h=({data:e})=>{let t={id:e.id,url:e.url,title:`${e.title} - /r/${e.subreddit}`};const r=e.crosspost_parent_list;if(e.media&&(t.media=e.media),r&&r.length>0){const e=r[0];e.url&&(t.url=e.url),e.media&&(t.media=e.media)}return t},f=async(e,t)=>{const r=Object(l.parse)(e,!0),i={...r.query,limit:5};t&&(i.after=t);const o=Object(n.a)(i),a=`${r.protocol}//${r.hostname}${r.pathname}.json?${o}`,[s]=await g(a,{headers:{Referer:u.c}});return s},y=e=>{return e.data.children.filter(e=>!e.data.stickied).map(h)};var w={match(e,t){const r=!!c.exec(e.href),i=!!e.pathname&&e.pathname.includes("/comments/");return r&&!i||!(!t.req.state||!t.req.state.reddit)},async resolve(e,t){const r=e.req.state;let i,o,a,l;if(r&&r.reddit)i=r.reddit.href,o=r.reddit.children,a=r.reddit.after,l=r.reddit.idx;else{i=e.req.url.href;const r=await f(i);if(console.log("Subreddit JSON",r),r.error)return console.debug("Error fetching subreddit posts"),t();const n=y(r);if(0===n.length)return t();o=n,a=r.data.after,l=-1}let n=l+1,s=o[n];if(!s){const e=await f(r.reddit.href,r.reddit.after),i=y(e);if(0===i.length)return t();if(s=(o=i)[n=0],a=e.data.after,!s)return}if(e.res.type="playlist",e.res.hasMore=!0,e.res.state={...e.res.state,reddit:{...(r||{}).reddit,href:i,idx:n,children:o,after:a}},!((e,t)=>{e.res.title=t.title;const r=new URL(t.url);r&&r.href&&(e.req.url=r);const{media:i}=t;if(i){if(i.reddit_video){const t=i.reddit_video;r&&r.href&&(e.res.url=r.href);const o=1e3*t.duration;return o&&(e.res.duration=o),!0}if(i.oembed)return!1}return!1})(e,s)){await t();let r=s.title||e.res.title;return e.res.title=r,e.res}}},I=r(103);const b=/youtu\.?be(?:.com)?/i,v=[/youtu\.be\/([^#\&\?]{11})/,/\?v=([^#\&\?]{11})/,/\&v=([^#\&\?]{11})/,/embed\/([^#\&\?]{11})/,/\/v\/([^#\&\?]{11})/];class N{static getInstance(){return this.instance||(this.instance=new N),this.instance}getVideoId(e){let t;for(let r=0;r<v.length&&!(t=v[r].exec(e));r++);return t?t[1]:null}}var P={match(e){const{hostname:t="",href:r=""}=e;return!!b.exec(t)&&!!N.getInstance().getVideoId(r)},async resolve(e,t){let r;try{r=await async function(e,t){const r=t("meta[itemprop=duration]").attr("content"),i=t("meta[itemprop=isLiveBroadcast]"),o=t("meta[itemprop=endDate]");let a;a="true"!==(i.attr("content")||"").toLowerCase()||o?r?1e3*Object(I.f)(r):void 0:0;const l=t("#eow-description"),n=1===l.length?Object(I.e)(l):void 0;return e.searchParams.has("t"),{duration:a,description:n}}(e.req.url,e.state.$)}catch(e){return console.error("YouTube request failed",e.message),t()}return Object(I.b)(e.res,r),e.res.state.referrer=!0,e.state.oEmbed=!1,t()}};const V=/youtu\.?be(?:.com)?/i;var j={match(e,t){const r=!!V.exec(e.href),i=e.searchParams.has("list");return r&&i||Boolean(t.req.state&&t.req.state.ytpl)},async resolve(e,t){const{state:r}=e.req,i=r&&r.ytpl||{};if(void 0===i.index){await t();const{res:r}=e,{body:o,$:a}=e.state;if(!o||!a)return;const l=a(".playlist-title").text()||r.title;i.title=(l||"YouTube Playlist").trim();const n=a("#playlist-length").text().split(" ")[0],s=parseInt(n,10);if(isNaN(s))return;i.length=s;const p=a("li.currently-playing").data("index"),d=e.req.url.searchParams,m=p||d.get("index")||"0";i.index=parseInt(m,10)||0,e.res.state.ytpl=i}else{i.index++;const t=e.req.url;t.pathname="/embed/videoseries",t.searchParams.set("index",`${i.index}`),e.res.url=t.toString()}let{index:o,length:a,title:l}=i;return e.res.title=l,e.res.state={...e.req.state,ytpl:i,referrer:!0},e.res.hasMore=o<a-1,e.res}};var x={match:({protocol:e})=>"http:"===e||"https:"===e,async resolve(e,t){const{url:r}=e.req;let i;try{i=await(async(e,t)=>{return await m(e,t)})(r.href,{method:"HEAD",headers:{"user-agent":u.e,referer:r.href}})}catch{return e.state.httpHeadFailed=!0,t()}const o=i.status||200,a=i.headers.server,l=(e=>(e=(e=Array.isArray(e)?e[0]:e)&&e.split(";").shift()||"").trim())(i.headers["content-type"]),n=(e=>e?(e.split("/").shift()||"").toLowerCase():"")(l);return e.state.responseCode=o,e.state.contentType=l,e.state.type=n,e.state.disableGooglebot="cloudflare"===a,t()}},O=r(87);const W=new Set(["audio","image","video"]);var q={match:({protocol:e})=>"http:"===e||"https:"===e,resolve({req:e,res:t,state:r},i){const{url:o}=e,{type:a}=r;if(a&&W.has(a)){const e=function(e){return{url:e.href,title:Object(O.basename)(e.pathname||e.href)}}(o);return t.url=e.url||t.url,t.title=t.title||e.title,t}return i()}},A=r(614);var H={match:({protocol:e})=>"http:"===e||"https:"===e,async resolve(e,t){const{url:r}=e.req;if(e.state.httpHeadFailed)return t();let i;try{i=(await g(r.href,{headers:e.state.disableGooglebot?{}:{"user-agent":u.e,host:r.host}}))[0]}catch{return t()}e.state.body=i;const o=e.state.$=Object(A.load)(i);return e.res.title=o("title").text().trim()||e.res.title,t()}},S=r(908);const L=[{multiple:!1,property:"og:title",fieldName:"ogTitle"},{multiple:!1,property:"og:type",fieldName:"ogType"},{multiple:!0,property:"og:image",fieldName:"ogImage"},{multiple:!0,property:"og:image:url",fieldName:"ogImageURL"},{multiple:!0,property:"og:image:secure_url",fieldName:"ogImageSecureURL"},{multiple:!0,property:"og:image:width",fieldName:"ogImageWidth"},{multiple:!0,property:"og:image:height",fieldName:"ogImageHeight"},{multiple:!0,property:"og:image:type",fieldName:"ogImageType"},{multiple:!1,property:"og:url",fieldName:"ogUrl"},{multiple:!1,property:"og:audio",fieldName:"ogAudio"},{multiple:!1,property:"og:audio:url",fieldName:"ogAudioURL"},{multiple:!1,property:"og:audio:secure_url",fieldName:"ogAudioSecureURL"},{multiple:!1,property:"og:audio:type",fieldName:"ogAudioType"},{multiple:!1,property:"og:description",fieldName:"ogDescription"},{multiple:!1,property:"og:determiner",fieldName:"ogDeterminer"},{multiple:!1,property:"og:locale",fieldName:"ogLocale"},{multiple:!1,property:"og:locale:alternate",fieldName:"ogLocaleAlternate"},{multiple:!1,property:"og:site_name",fieldName:"ogSiteName"},{multiple:!0,property:"og:video",fieldName:"ogVideo"},{multiple:!0,property:"og:video:url",fieldName:"ogVideo"},{multiple:!0,property:"og:video:secure_url",fieldName:"ogVideoSecureURL"},{multiple:!0,property:"og:video:width",fieldName:"ogVideoWidth"},{multiple:!0,property:"og:video:height",fieldName:"ogVideoHeight"},{multiple:!0,property:"og:video:type",fieldName:"ogVideoType"},{multiple:!0,property:"og:video:duration",fieldName:"ogVideoDuration"},{multiple:!0,property:"video:duration",fieldName:"videoDuration"},{multiple:!1,property:"twitter:card",fieldName:"twitterCard"},{multiple:!1,property:"twitter:site",fieldName:"twitterSite"},{multiple:!1,property:"twitter:site:id",fieldName:"twitterSiteId"},{multiple:!1,property:"twitter:creator",fieldName:"twitterCreator"},{multiple:!1,property:"twitter:creator:id",fieldName:"twitterCreatorId"},{multiple:!1,property:"twitter:title",fieldName:"twitterTitle"},{multiple:!1,property:"twitter:description",fieldName:"twitterDescription"},{multiple:!0,property:"twitter:image",fieldName:"twitterImage"},{multiple:!0,property:"twitter:image:height",fieldName:"twitterImageHeight"},{multiple:!0,property:"twitter:image:width",fieldName:"twitterImageWidth"},{multiple:!0,property:"twitter:image:src",fieldName:"twitterImageSrc"},{multiple:!0,property:"twitter:image:alt",fieldName:"twitterImageAlt"},{multiple:!0,property:"twitter:player",fieldName:"twitterPlayer"},{multiple:!0,property:"twitter:player:width",fieldName:"twitterPlayerWidth"},{multiple:!0,property:"twitter:player:height",fieldName:"twitterPlayerHeight"},{multiple:!0,property:"twitter:player:stream",fieldName:"twitterPlayerStream"},{multiple:!1,property:"twitter:app:name:iphone",fieldName:"twitterAppNameiPhone"},{multiple:!1,property:"twitter:app:id:iphone",fieldName:"twitterAppIdiPhone"},{multiple:!1,property:"twitter:app:url:iphone",fieldName:"twitterAppUrliPhone"},{multiple:!1,property:"twitter:app:name:ipad",fieldName:"twitterAppNameiPad"},{multiple:!1,property:"twitter:app:id:ipad",fieldName:"twitterAppIdiPad"},{multiple:!1,property:"twitter:app:url:ipad",fieldName:"twitterAppUrliPad"},{multiple:!1,property:"twitter:app:name:googleplay",fieldName:"twitterAppNameGooglePlay"},{multiple:!1,property:"twitter:app:id:googleplay",fieldName:"twitterAppIdGooglePlay"},{multiple:!1,property:"twitter:app:url:googleplay",fieldName:"twitterAppUrlGooglePlay"}];var T=function(e){return{url:e[0],width:e[1],height:e[2],alt:e[3]}},$=function(e){return{url:e[0],width:e[1],height:e[2],stream:e[3]}},U=function(e){return{url:e[0],width:e[1],height:e[2],type:e[3],duration:(t=e[4],isNaN(t)||(t=t%1==0?parseInt(t,10):parseFloat(t)),t)};var t},E=function(e,t){if(!e.url||!t.url)return 0;var r=e.url.match(/\.(\w{2,5})$/),i=r&&r[1].toLowerCase()||null,o=t.url.match(/\.(\w{2,5})$/),a=o&&o[1].toLowerCase()||null;return"gif"===i&&"gif"!==a?-1:"gif"!==i&&"gif"===a?1:Math.max(t.width,t.height)-Math.max(e.width,e.height)};const R=new Set(["application/x-shockwave-flash"]),M=new Set(["www.netflix.com"]);function D(e,t){const r=function(e,t){const r=void 0===t.ogImageFallback||t.ogImageFallback;let i=Object(A.load)(e),o=i("meta"),a=Object.keys(o),l={};a.forEach(function(e){if(o[e].attribs&&(o[e].attribs.property||o[e].attribs.name)){var t=o[e].attribs.property||o[e].attribs.name,r=o[e].attribs.content;L.forEach(function(e){t===e.property&&(e.multiple?l[e.fieldName]?Array.isArray(l[e.fieldName])&&l[e.fieldName].push(r):l[e.fieldName]=[r]:l[e.fieldName]=r)})}}),l.ogImage=l.ogImageSecureURL?l.ogImageSecureURL:l.ogImage?l.ogImage:l.ogImageURL?l.ogImageURL:[],l.ogImage&&l.ogImage.length||delete l.ogImage,(l.ogImage||l.ogImageWidth||l.twitterImageHeight||l.ogImageType)&&(l.ogImage=l.ogImage?l.ogImage:[null],l.ogImageWidth=l.ogImageWidth?l.ogImageWidth:[null],l.ogImageHeight=l.ogImageHeight?l.ogImageHeight:[null],l.ogImageType=l.ogImageType?l.ogImageType:[null]);var n=Object(S.a)(l.ogImage,l.ogImageWidth,l.ogImageHeight,l.ogImageType).map(U).sort(E);(l.ogVideo||l.ogVideoWidth||l.ogVideoHeight||l.ogVideoType||l.ogVideoDuration)&&(l.ogVideo=l.ogVideo?l.ogVideo:[null],l.ogVideo=l.ogVideoSecureURL?l.ogVideoSecureURL:l.ogVideo,l.ogVideoWidth=l.ogVideoWidth?l.ogVideoWidth:[null],l.ogVideoHeight=l.ogVideoHeight?l.ogVideoHeight:[null],l.ogVideoType=l.ogVideoType?l.ogVideoType:[null],l.ogVideoDuration=l.videoDuration||l.ogVideoDuration||[null]);var s=Object(S.a)(l.ogVideo,l.ogVideoWidth,l.ogVideoHeight,l.ogVideoType,l.ogVideoDuration).map(U).sort(E);(l.twitterImageSrc||l.twitterImage||l.twitterImageWidth||l.twitterImageHeight||l.twitterImageAlt)&&(l.twitterImage=l.twitterImage?l.twitterImage:l.twitterImageSrc,l.twitterImage=l.twitterImage?l.twitterImage:[null],l.twitterImageWidth=l.twitterImageWidth?l.twitterImageWidth:[null],l.twitterImageHeight=l.twitterImageHeight?l.twitterImageHeight:[null],l.twitterImageAlt=l.twitterImageAlt?l.twitterImageAlt:[null]);var p=Object(S.a)(l.twitterImage,l.twitterImageWidth,l.twitterImageHeight,l.twitterImageAlt).map(T).sort(E);(l.twitterPlayer||l.twitterPlayerWidth||l.twitterPlayerHeight||l.twitterPlayerStream)&&(l.twitterPlayer=l.twitterPlayer?l.twitterPlayer:[null],l.twitterPlayerWidth=l.twitterPlayerWidth?l.twitterPlayerWidth:[null],l.twitterPlayerHeight=l.twitterPlayerHeight?l.twitterPlayerHeight:[null],l.twitterPlayerStream=l.twitterPlayerStream?l.twitterPlayerStream:[null]);var d=Object(S.a)(l.twitterPlayer,l.twitterPlayerWidth,l.twitterPlayerHeight,l.twitterPlayerStream).map($).sort(E);if(L.filter(function(e){return e.multiple}).forEach(function(e){delete l[e.fieldName]}),n.length&&(t.allMedia?l.ogImage=n:l.ogImage=n[0]),s.length&&(t.allMedia?l.ogVideo=s:l.ogVideo=s[0]),p.length&&(t.allMedia?l.twitterImage=p:l.twitterImage=p[0]),d.length&&(t.allMedia?l.twitterPlayer=d:l.twitterPlayer=d[0]),!t.onlyGetOpenGraphInfo&&(!l.ogTitle&&i("head > title").text()&&i("head > title").text().length>0&&(l.ogTitle=i("head > title").text()),!l.ogDescription&&i('head > meta[name="description"]').attr("content")&&i('head > meta[name="description"]').attr("content").length>0&&(l.ogDescription=i('head > meta[name="description"]').attr("content")),!l.ogImage&&r)){var m=["jpg","jpeg","png"];i("img").each(function(e,t){if(i(t).attr("src")&&i(t).attr("src").length>0&&-1!==m.indexOf(i(t).attr("src").split(".").pop()))return l.ogImage={url:i(t).attr("src")},!1})}return l}(t,{});console.log("og",r);const{ogTitle:i,ogImage:o,ogDescription:a}=r,l=o?{0:o.url}:void 0,s={url:e.href,title:i,thumbnails:l,description:a};let p=!M.has(e.hostname);if(p&&r.ogVideo){const e=r.ogVideo.type,t=r.ogVideo.url;(p=(!e||!R.has(e))&&t&&Object(n.c)(t))&&(s.url=t),r.ogVideo.duration&&(s.duration=1e3*r.ogVideo.duration)}return s}var k={match:({protocol:e})=>"http:"===e||"https:"===e,async resolve(e,t){const{url:r}=e.req,{$:i,body:o}=e.state;if(i&&o){const t=D(r,o);Object(I.b)(e.res,t)}return t()}};const _=/\/wp-json\/oembed\/.*?\/embed/i;var C={match:({protocol:e})=>"http:"===e||"https:"===e,async resolve(e,t){if("boolean"==typeof e.state.oEmbed&&!e.state.oEmbed)return t();const{url:r}=e.req;let i;if(e.state.oEmbedJson)i=e.state.oEmbedJson;else if(e.state.$){const{$:t}=e.state,r=t("link[type='text/json+oembed'], link[type='application/json+oembed']").attr("href");r&&!_.test(r)&&(i=await async function(e){const[t]=await g(e,{headers:{"user-agent":u.e}});return t}(r))}if(i){console.info("oembed",i);const t={url:function(e){if("string"==typeof e.html){const t=e.html.startsWith("&lt;")?Object(A.load)(e.html)("body").text():e.html;let r=Object(A.load)(t)("iframe").attr("src");if(r)return r.startsWith("//")?`https:${r}`:r}}(i),description:i.description};Object(I.b)(e.res,t)}return t()}};const G=(e,t)=>{if(t[e])return t[e]="true",!0};var F={match:({protocol:e,host:t})=>!(t&&t.indexOf("redd.it")>-1)&&("http:"===e||"https:"===e),async resolve(e,t){const{url:r}=e.res;return!!r&&r.endsWith("mp4")||(e.res.url=(e=>{const t=Object(l.parse)(e,!0),{query:r}=t;return G("autoplay",r)||G("auto_play",r)||["autoplay","auto_play"].forEach(e=>{r[e]="true"}),t.search=Object(n.a)(r),Object(l.format)(t)})(r)),t()}},J=r(904);var B={match:({protocol:e})=>"http:"===e||"https:"===e,async resolve(e,t){const{url:r}=e.req,{$:i}=e.state;if(i){i("noscript").each(function(t,r){const i=e.state.$(r).text();if(-1===i.indexOf("schema.org"))return;const o=Object(A.load)(i)("meta[itemprop='duration']").attr("content");if(o){const t=1e3*Object(J.toSeconds)(Object(J.parse)(o));t&&!isNaN(t)&&(e.res.duration=t)}})}return t()}};var Y={match(e){const{hostname:t=""}=e;return t.endsWith("imgur.com")},async resolve(e,t){const{$:r}=e.state;if(r){const i=r("title").text().trim(),o=r("link[rel=image_src]").attr("href");if(!i.endsWith("Album on Imgur")&&o)return await t(),e.res.url=o,e.res}return t()}};class X extends Error{constructor(e){super(`Media Request Error (${e})`),this.code=e,Object.setPrototypeOf(this,X.prototype)}}new Set(["image/gif","text/html","image/jpeg","audio/mpeg","video/mpeg","audio/ogg","video/ogg","application/ogg","audio/opus","image/svg+xml","text/plain","audio/wav","audio/webm","video/webm","image/webp","application/xhtml+xml"]);var z={match:({protocol:e})=>"http:"===e||"https:"===e,async resolve(e,t){const{contentType:r,headResponseHeaders:i}=e.state;if(i){const e=i["content-disposition"];if("string"==typeof e&&e.startsWith("attachment"))throw new X(3)}return t()}};r.d(t,"resolveMediaUrl",function(){return ee}),r.d(t,"resolveMediaPlaylist",function(){return te});const K=[a,w,j,x,z,q,H,P,Y,k,C,B,F],Q=e=>{return{req:{type:"item",url:e,user:null},res:{type:"item",url:e.href,state:{}},state:{}}},Z=e=>{if(e.description){const t=e.description.trim();e.description=t||void 0}return Object(i.a)(e)},ee=async e=>{const t=new URL(e);if(!t.href)return null;const r=Q(t),i=o(K),a=await i(r)||r.res;return console.debug("Resolved media",r),Z(a)},te=async e=>{const t=new URL(e.url);if(!t.href)return null;const r=Q(t);r.req={...r.req,type:e.type,state:e.state},console.log("resolving playlist",r);const i=o(K),a=await i(r)||r.res;return Z(a)}},742:function(e,t){}}]);
//# sourceMappingURL=3.app.prod.js.map